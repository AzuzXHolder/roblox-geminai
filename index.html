<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script>
    // Immediately run this script when the page loads
    (function() {
      // Get the prompt from URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const prompt = urlParams.get('prompt');
      
      // Define the function to query Gemini API
      async function queryGemini(promptText) {
        const GEMINI_API_KEY = 'AIzaSyAFRqJdn1TEIvKT3Dj4StbDCgAiJUpC28I';
        
        const body = {
          contents: [{
            parts: [{ text: promptText }]
          }]
        };
        
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`,
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          }
        );
        
        const data = await response.json();
        return {
          prompt: promptText,
          response: data?.candidates?[0]?.content?.parts?[0]?.text || "No response."
        };
      }
      
      // Process the prompt and output pure JSON
      if (prompt) {
        queryGemini(prompt)
          .then(result => {
            // Clear everything from the page
            document.body.innerHTML = '';
            document.head.innerHTML = '';
            
            // Set content type as JSON
            document.contentType = 'application/json';
            
            // Replace entire document with just JSON
            document.open('text/plain');
            document.write(JSON.stringify(result));
            document.close();
          })
          .catch(error => {
            document.open('text/plain');
            document.write(JSON.stringify({
              prompt: prompt,
              error: error.message
            }));
            document.close();
          });
      } else {
        document.open('text/plain');
        document.write(JSON.stringify({
          error: "Missing prompt parameter",
          usage: "Add ?prompt=YourQuestion to the URL"
        }));
        document.close();
      }
    })();
  </script>
</head>
<body>
  <!-- This content will be replaced with JSON -->
</body>
</html>
