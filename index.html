<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gemini API Proxy</title>
  <script>
    // Replace with your Gemini API key
    const GEMINI_API_KEY = 'AIzaSyAFRqJdn1TEIvKT3Dj4StbDCgAiJUpC28I';
    
    async function queryGemini(prompt) {
      try {
        const body = {
          contents: [{
            parts: [{ text: prompt }]
          }]
        };
        
        const res = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`,
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          }
        );
        
        const data = await res.json();
        return {
          prompt: prompt,
          response: data?.candidates?.[0]?.content?.parts?.[0]?.text || "No response."
        };
      } catch (error) {
        return {
          prompt: prompt,
          error: error.message
        };
      }
    }

    // Process the request immediately
    (async () => {
      const params = new URLSearchParams(window.location.search);
      const prompt = params.get("prompt");
      
      let result;
      if (prompt) {
        result = await queryGemini(prompt);
      } else {
        result = {
          error: "Missing prompt parameter",
          usage: "Add ?prompt=YourQuestion to the URL"
        };
      }

      // Clear EVERYTHING and only write the JSON
      document.open();
      document.write(JSON.stringify(result));
      document.close();
    })();
  </script>
</head>
<body>
</body>
</html>
